codemr.treemap=function(){codemr.treemap.paintCallBack=function(){u.style("fill",function(t){return EQ_GET_COLOR(t)})};var e,a,o=codemr.metricchart("metric-chart-in-treemap",classMetricSpec,classMetricValues),i=1200,l=620,c=d3.scale.linear().range([0,i]),d=d3.scale.linear().range([0,l]),t=(d3.scale.category20c(),d3.layout.treemap().round(!1).size([i,l]).sticky(!0).value(function(t){return t.value})),s=d3.select("#treemap-chart-body").append("div").attr("class","treemapchart").style("width",i+"px").style("height",l+"px").append("svg:svg").attr("width",i).attr("height",l).append("svg:g").attr("transform","translate(.5,.5)");e=EQ_GET_DATA(),a=e;var n=t.nodes(e),r=s.selectAll("g").data(n).enter().append("svg:g").attr("class","cell").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).on("click",function(t){return h(a==t.parent?e:t.parent)}).on("mousemove",function(t){return m(t)}).on("mouseout",function(t){return f(t)}),u=r.append("svg:rect");u.attr("class","treerect").attr("width",function(t){return 1<t.dx?t.dx-1:0}).attr("height",function(t){return 1<t.dy?t.dy-1:0}).style("fill-opacity",function(t){return t.children?0:.8}).style("fill",function(t){return EQ_GET_COLOR(t)}).style("stroke",function(t){return t.children?"#000000":"none"}).style("stroke-width",function(t){return t.children?2:0}),r.append("svg:text").attr("class","treemaptext").attr("x",function(t){return t.dx/2}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.name}).style("opacity",function(t){return t.w=this.getComputedTextLength(),t.h=this.clientHeight,0==t.depth||1==t.depth?0:0!=a.depth||t.children?t.h>t.dy?0:t.dx>t.w?1:0:0});var p=t.nodes(e).filter(function(t){return 1==t.depth});s.selectAll("g2").data(p).enter().append("svg:text").attr("class","packageNodesText").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).attr("x",function(t){return t.dx/2}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.name}).style("opacity",function(t){return t.w=this.getComputedTextLength(),t.h=this.clientHeight,0!=a.depth||t.children?t.h>t.dy?0:t.dx>t.w?1:0:0});function h(t){var e=i/t.dx,n=l/t.dy;c.domain([t.x,t.x+t.dx]),d.domain([t.y,t.y+t.dy]),a=t;var r=s.selectAll("g.cell").transition().duration(d3.event.altKey?7500:750).attr("transform",function(t){return"translate("+c(t.x)+","+d(t.y)+")"});r.select("rect").attr("width",function(t){return ret=e*t.dx-1,0<ret?ret:0}).attr("height",function(t){var e=n*t.dy-1;return 0<e?e:0}),r.select("text").attr("x",function(t){return e*t.dx/2}).attr("y",function(t){return n*t.dy/2}).style("opacity",function(t){return 0!=a.depth||t.children?0==t.depth||1==t.depth?0:t.h>t.dy*n?0:e*t.dx>t.w?1:0:0}),s.selectAll(".packageNodesText").transition().duration(d3.event.altKey?7500:750).attr("transform",function(t){return"translate("+c(t.x)+","+d(t.y)+")"}).style("opacity",function(t){return 0!=a.depth?0:t.h>t.dy*n?0:e*t.dx>t.w?1:0}),d3.event.stopPropagation()}d3.select(window).on("click",function(){h(e)});var y=null,m=function(t){elem=document.getElementsByClassName("treemapchart"),boundingRect=elem[0].getBoundingClientRect(),d3.event.ctrlKey||d3.event.metaKey?o.setVisible(!0):o.setVisible(!1);var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,r=d3.event.pageX,a=d3.event.pageY,i=o.getWidth();if(d3.event.pageX>boundingRect.left+600){var l=e-r;r<i&&(l=e-i),d3.select("#tooltip").style("right",l+"px"),d3.select("#tooltip").style("left","auto")}else{var c=r;e<r+i&&(c=e-i),d3.select("#tooltip").style("left",c+"px"),d3.select("#tooltip").style("right","auto")}d3.event.pageY>boundingRect.top+310?(d3.select("#tooltip").style("bottom",n-a+"px"),d3.select("#tooltip").style("top","auto")):(d3.select("#tooltip").style("top",a+"px"),d3.select("#tooltip").style("bottom","auto")),d3.select("#tooltip #parent").text(t.parent.name),d3.select("#tooltip #name").text(t.name),d3.select("#tooltip #metricvalue").text(EQ_getSelectedMetricName(t)+" : "+EQ_GET_METRICVALUE(t)),d3.select("#tooltip").classed("hidden",!1),y!==t&&t.metrics&&(o.updateMetricValues(EQ_convertMetricValues(t.metricvalues)),y=t,"function"==typeof updateSelectedElement&&updateSelectedElement(t.parent?t.parent.name:"",t.key))},f=function(t){d3.select("#tooltip").classed("hidden",!0)}};
